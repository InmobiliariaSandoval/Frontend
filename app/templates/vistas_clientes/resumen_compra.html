<!DOCTYPE html>
<html lang="es">
<head>
    <title>Resumen de la compra</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Página que muestra el resumen de la compra realizada">
    <meta name="author" content="@jannethsm31 y @PatricioVargasR">
    <link rel="shortcut icon" href="{{ url_for('static', filename='icons/favicon.ico')}}">

    <!-- FontAwesome JS-->
    <script defer src="{{ url_for('static', filename='plugins/fontawesome/js/all.min.js') }}"></script>

    <!-- App CSS -->
    <link id="theme-style" rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

</head>

<body class="app">
    <header class="app-header fixed-top">


       <!--BARRA BUSCAR, NOTIFICACIONES, Y CERRAR SESION-->
        <div class="app-header-inner">
	        <div class="container-fluid py-2">
		        <div class="app-header-content">
		            <div class="row justify-content-between align-items-center">

				    <div class="col-auto">
					    <a id="sidepanel-toggler" class="sidepanel-toggler d-inline-block d-xl-none" href="#">
						    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img"><title>Menú</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg>
					    </a>
				    </div><!--//col-->
		            <div class="search-mobile-trigger d-sm-none col">
			            <i class="search-mobile-trigger-icon fa-solid fa-magnifying-glass"></i>
			        </div><!--//col-->
		            <div class="app-search-box col">
		                <form class="app-search-form" action="{{ url_for('generales.buscar_opciones') }}" method="POST">
							<input type="text" placeholder="Buscar..." name="buscar" list="opciones" class="form-control search-input">
							<button type="submit" class="btn search-btn btn-primary" value="buscar"><i class="fa-solid fa-magnifying-glass"></i></button>
				        </form>
		            </div><!--//app-search-box-->

		            <div class="app-utilities col-auto">
			            <div class="app-utility-item app-notifications-dropdown dropdown">
				            <a class="dropdown-toggle no-toggle-arrow" id="notifications-dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false" title="Notifications">
					            <!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
					            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-bell icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2z"/>
									<path fill-rule="evenodd" d="M8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
								</svg>
								{% if notificaciones or notificaciones|length != 0 or total_notificaciones != 0 %}
					            	<span class="icon-badge">
										{{ total_notificaciones }}
									</span>
								{% endif %}
					        </a><!--//dropdown-toggle-->

							<!-- Area de notificaciones -->
					        <div class="dropdown-menu p-0" aria-labelledby="notifications-dropdown-toggle">
					            <div class="dropdown-menu-header p-3">
						            <h5 class="dropdown-menu-title mb-0">Notificaciones</h5>
						        </div><!--//dropdown-menu-title-->

								<!-- Aquí irán las notificaciones-->
						        <div class="dropdown-menu-content">
									{% if not notificaciones or notificaciones|length == 0 %}
										<div class="item p-3">
											No hay notificaciones
										</div>
									{% endif %}
									{% if notificaciones and notificaciones|length != 0 %}
										{% for notificacion in notificaciones %}
											<div class="item p-3">
												<div class="row gx-2 justify-content-between align-items-center">
													<div class="col">
														<div class="info">
															<div class="desc">
																{{ notificacion.descripcion }}
															</div>
															<div class="meta">
																{{ notificacion.fecha }}
															</div>
														</div>
													</div>
												</div>
											</div>
										{% endfor %}
									{% endif %}
								</div>
							<!-- </div> -->
						        <div class="dropdown-menu-footer p-2 text-center">
							        <a href="/ver_notificaciones">Ver todas</a>
						        </div>

							</div><!--//dropdown-menu-->
				        </div><!--//app-utility-item-->
			            <div class="app-utility-item app-user-dropdown dropdown">
							<a class="dropdown-toggle" id="user-dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
									<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
									<path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
								  </svg>
							</a>
							<ul class="dropdown-menu" aria-labelledby="user-dropdown-toggle">
								<li><a class="dropdown-item" href="/configuracion">Configuración</a></li>
								<li><hr class="dropdown-divider"></li>
								<li><button class="dropdown-item" onclick="cerrar_sesion()">Cerrar sesión</button></li>
							</ul>
						</div><!--//app-utilities-->
		            </div><!--//app-utilities-->
		        </div><!--//row-->
	            </div><!--//app-header-content-->
	        </div><!--//container-fluid-->
        </div><!--//app-header-inner-->
		<!--BARRA NOTIFICACIONES ETC.-->

		<!--SIDEBAR-->
	<div id="app-sidepanel" class="app-sidepanel">
		<div id="sidepanel-drop" class="sidepanel-drop"></div>
		<div class="sidepanel-inner d-flex flex-column">
			<a href="#" id="sidepanel-close" class="sidepanel-close d-xl-none">&times;</a>
			<div class="app-branding">
				<a class="app-logo" href="/resumen">
					<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-houses-fill me-2" viewBox="0 0 16 16">
						<path d="M7.207 1a1 1 0 0 0-1.414 0L.146 6.646a.5.5 0 0 0 .708.708L1 7.207V12.5A1.5 1.5 0 0 0 2.5 14h.55a2.5 2.5 0 0 1-.05-.5V9.415a1.5 1.5 0 0 1-.56-2.475l5.353-5.354z"/>
						<path d="M8.793 2a1 1 0 0 1 1.414 0L12 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l1.854 1.853a.5.5 0 0 1-.708.708L15 8.207V13.5a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 4 13.5V8.207l-.146.147a.5.5 0 1 1-.708-.708z"/>
					</svg>
					<span class="logo-text" style="font-size: 0.85rem;">Inmobiliaria Grupo Sandoval</span>
				</a>
			</div>

			<nav id="app-nav-main" class="app-nav app-nav-main flex-grow-1">
				<ul class="app-menu list-unstyled accordion" id="menu-accordion">
					<li class="nav-item">
						<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
						<a class="nav-link" href="/resumen">
							<span class="nav-icon">
								<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-house-door" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path fill-rule="evenodd" d="M7.646 1.146a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 .146.354v7a.5.5 0 0 1-.5.5H9.5a.5.5 0 0 1-.5-.5v-4H7v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .146-.354l6-6zM2.5 7.707V14H6v-4a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4h3.5V7.707L8 2.207l-5.5 5.5z"/>
									<path fill-rule="evenodd" d="M13 2.5V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>
								</svg>
							 </span>
							 <span class="nav-link-text">Resumen</span>
						</a><!--//nav-link-->
					</li><!--//nav-item-->
					<li class="nav-item">
						<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
						<a class="nav-link" href="/informacion_cliente_venta">
							<span class="nav-icon">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
									<path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
								</svg>
							 </span>
							 <span class="nav-link-text">Clientes y ventas</span>
						</a><!--//nav-link-->
					</li><!--//nav-item-->
					<li class="nav-item">
						<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
						<a class="nav-link" href="/ver_vendedores">
							<span class="nav-icon">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-square" viewBox="0 0 16 16">
									<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
									<path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1v-1c0-1-1-4-6-4s-6 3-6 4v1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
								</svg>
							 </span>
							 <span class="nav-link-text">Vendedores</span>
						</a><!--//nav-link-->
					</li><!--//nav-item-->
					<li class="nav-item has-submenu">
						<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
						<a class="nav-link active" href="#" data-bs-toggle="collapse" data-bs-target="#submenu-1" aria-expanded="false" aria-controls="submenu-1">
							<span class="nav-icon">
							<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-houses" viewBox="0 0 16 16">
								<path d="M5.793 1a1 1 0 0 1 1.414 0l.647.646a.5.5 0 1 1-.708.708L6.5 1.707 2 6.207V12.5a.5.5 0 0 0 .5.5.5.5 0 0 1 0 1A1.5 1.5 0 0 1 1 12.5V7.207l-.146.147a.5.5 0 0 1-.708-.708zm3 1a1 1 0 0 1 1.414 0L12 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l1.854 1.853a.5.5 0 0 1-.708.708L15 8.207V13.5a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 4 13.5V8.207l-.146.147a.5.5 0 1 1-.708-.708zm.707.707L5 7.207V13.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V7.207z"/>
							</svg>
							 </span>
							 <span class="nav-link-text">Lotes</span>
							 <span class="submenu-arrow">
								 <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
								</svg>
							 </span><!--//submenu-arrow-->
						</a><!--//nav-link-->
						<div id="submenu-1" class="collapse submenu submenu-1" data-bs-parent="#menu-accordion">
							<ul class="submenu-list list-unstyled">
								<li class="submenu-item"><a class="submenu-link" href="/estados_republica">Estados</a></li>
						</div>
					</li><!--//nav-item-->
					<li class="nav-item has-submenu">
						<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
						<a class="nav-link submenu-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#submenu-2" aria-expanded="false" aria-controls="submenu-2">
							<span class="nav-icon">
							<!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
							<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-columns-gap" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" d="M6 1H1v3h5V1zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12h-5v3h5v-3zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8H1v7h5V8zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6h-5v7h5V1zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z"/>
							</svg>
							 </span>
							 <span class="nav-link-text">Otros</span>
							 <span class="submenu-arrow">
								 <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
								</svg>
							 </span><!--//submenu-arrow-->
						</a><!--//nav-link-->
						<div id="submenu-2" class="collapse submenu submenu-2" data-bs-parent="#menu-accordion">
							<ul class="submenu-list list-unstyled">
								<li class="submenu-item"><a class="submenu-link" href="/reset_password">Recuperar contraseña</a></li>
							</ul>
						</div>
					</li><!--//nav-item-->
				</ul><!--//app-menu-->
			</nav><!--//app-nav-->
		</div>
	</div>
    </header><!--//app-header-->

    <div class="app-wrapper">
	    <div class="app-content pt-3 p-md-3 p-lg-4">
		    <div class="container-xl">
				{% with mensajes = get_flashed_messages(category_filter=["message"]) %}
					{% if mensajes %}
						{% for mensaje in mensajes %}
							<div class="alert alert-success alert-dismissible fade show" role="alert">
								{{ mensaje|safe }}
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							</div>
						{% endfor %}
					{% endif %}
				{% endwith %}
				{% with mensajes = get_flashed_messages(category_filter=["warning"]) %}
					{% if mensajes %}
						{% for mensaje in mensajes %}
							<div class="alert alert-warning alert-dismissible fade show" role="alert">
								{{ mensaje|safe }}
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							</div>
						{% endfor %}
					{% endif %}
				{% endwith %}

				{% with mensajes = get_flashed_messages(category_filter=["error"]) %}
					{% if mensajes %}
						{% for mensaje in mensajes %}
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								{{ mensaje|safe }}
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							</div>
						{% endfor %}
					{% endif %}
				{% endwith %}
                <div class="row g-3 mb-4 align-items-center justify-content-between">
                    <div class="col-12">
                        <div class="app-card app-card-account shadow-sm d-flex flex-column aling-items-start">
                            <div class="app-card-header p-3 border-bottom-0">
                                <div class="row align-items-center gx-3">
                                    <div class="col-auto">
                                        <h1 class="app-page-title mb-3">Resumen de la compra</h1>
                                    </div><!--//col-->
                                </div><!--//row-->
                            </div><!--//app-card--header-->
                            <div class="app-card-body px-4 w-100">
                                <div class="item border-bottom py-3">
                                    <div class="row justify-content-between align-items-center">
                                        <div class="col-auto" style="width: 100%;">
                                            <div class="item-label pb-2">
                                                <strong>
                                                    Información del lote
                                                </strong>
                                            </div>
											{% for dato in lote %}
												<div class="row">
													<div class="col-md-3">
														<div class="item-label mb-2"><strong>Estado</strong></div>
														<div class="item-label mb-2">Lote # {{ dato.numero_lote }}</div>
													</div>
													<div class="col-md-3">
														<div class="item-label mb-2"><strong>Medida total del lote</strong></div>
														<div class="item-label mb-2">{{ dato.medida_total }} m²</div>
													</div>
													<div class="col-md-3">
														<div class="item-label mb-2"><strong>Sección del complejo</strong></div>
														<div class="item-label mb-2">{{ dato.nombre_seccion }} </div>
													</div>
													{% for dato in ubicacion %}
														<div class="col-md-3">
															<div class="item-label mb-2"><strong>Complejo Residencial</strong></div>
															<div class="item-label mb-2">{{ dato.nombre_complejo }}</div>
														</div>
												{% endfor %}
												</div>
											{% endfor %}
                                        </div><!--/col-->
                                    </div><!--//row-->
                                </div><!--//item-->
								<div class="item py-3">
									<div class="row">
										<div class="item-label pb-2">
											<strong>
												Información de la compra
											</strong>
										</div>
										{% for dato in compra %}
											<div class="col-md-3 mb-4">
												<div class="item-label"><strong>Todal de la compra</strong></div>
												<div class="item-label">$ {{ dato.precio_total }} MXN </div>
											</div>
											<div class="col-md-3 mb-4">
												<div class="item-label"><strong>Estado de la compra</strong></div>
												<div class="item-label">{{ dato.estado_compra }}</div>
											</div>
											<div class="col-md-3 mb-4">
												<div class="item-label"><strong>Fecha de la compra</strong></div>
												<div class="item-label">{{ dato.fecha_compra }}</div>
											</div>
											<div class="col-md-3 mb-4">
												<div class="item-label"><strong>Cantidad total de plazos</strong></div>
												<div class="item-label">{{ dato.cantidad_total_plazos }}</div>
											</div>
										<hr>
										{% endfor %}
										<div class="item-label py-2">
											<strong>
												Información del cliente
											</strong>
										</div>
										{% for dato in cliente%}
										<div class="col-md-3 mb-4">
											<div class="item-label"><strong>Nombre del cliente</strong></div>
											<div class="item-label">
												{{ dato.nombres_cliente }}
												{{ dato.primer_apellido_cliente }} {{ dato.segundo_apellido_cliente }}
											</div>
										</div>
										<div class="col-md-3 mb-4">
											<div class="item-label"><strong>CURP del cliente</strong></div>
											<div class="item-label">
												{{ dato.CURP_cliente }}
											</div>
										</div>
										<div class="col-md-3 mb-4">
											<div class="item-label"><strong>Contacto del cliente</strong></div>
											<div class="item-label">
												{{ dato.telefono_contacto }}

											</div>
										</div>
									<hr>
									{% endfor %}
									<div class="item-label py-2">
										<strong>
											Información del vendedor
										</strong>
									</div>
									{% for dato in vendedor %}
										<div class="col-md-3">
											<div class="item-label mb-2"><strong>Nombre del vendedor</strong></div>
											<div class="item-label mb-2">
												{{ dato.nombres_vendedor }}
												{{ dato.primer_apellido_vendedor }} {{ dato.segundo_apellido_vendedor }}
											</div>
										</div>
										{% if dato.RFC_vendedor %}
										<div class="col-md-3">
											<div class="item-label mb-2"><strong>RFC del vendedor</strong></div>
											<div class="item-label mb-2">
												{{ dato.RFC_vendedor }}
											</div>
										</div>
										{% endif %}
										<div class="col-md-3">
											<div class="item-label mb-2"><strong>Contacto del vendedor</strong></div>
											<div class="item-label mb-2">
												{{ dato.correo_electronico }} - {{ dato.numero_telefono  }}
											</div>
										</div>
									{% endfor %}
									{% if plazos %}
										<hr>
										<div class="col-12 pt-2">
											<div class="row">
												<div class="col-md-12">
													<div class="item-label mb-3"><strong>Recibos totales</strong></div>
														<div class="app-card app-card-orders-table shadow-sm mb-2">
															<div class="app-card-body">
																<div class="table-responsive">
																	<table class="table app-tcable-hover mb-0 text-left">
																		<thead>
																			<tr>
																				<th class="cell">Fecha</th>
																				<th class="cell">Mes</th>
																				<th class="cell">Cantidad a pagar</th>
																				<th class="cell">Editar plazo</th>
																				<th class="cell">Eliminar plazo</th>
																				<th class="cell">Ver pago</th>
																				<th class="cell">Añadir pago</th>
																				<th class="cell">¿Pago completado?</th>
																			</tr>
																		</thead>
																		<tbody id="detalle_pagos">
																			{% for plazo in plazos %}
																			<tr data-id-plazo="{{ plazo.id_plazo }}">
																				<td class="cell fecha_esperada">{{ plazo.fecha_esperada }}</td>
																				<td class="cell numero_plazo">Mes {{ plazo.numero_plazo }}</td>
																				<td class="cell cantidad_esperada">${{ plazo.restante }} MXN</td>
																				<!-- <td class="cell" contenteditable="true" onblur="guardarDetalle(this)">  -->
																				<td class="cell">
																					<button type="button" class="btn btn-link text-decoration-none text-secondary mb-1" data-bs-toggle="modal" data-bs-target="#modalActualizar" onclick="agregar_valores('{{ plazo.id_plazo }}')">
																						Editar plazo
																					</button>
																				</td>
																				<td class="cell">
																					<button type="button" class="btn btn-link text-decoration-none text-danger mb-1" onclick="eliminar_plazo('{{plazo.id_plazo}}', '{{plazo.id_compra}}')">
																						<small>
																							Eliminar plazo
																						</small>
																					</button>
																				</td>
																				{% if plazo.restante != plazo.cantidad_esperada %}
																				<td class="cell">
																					<a class="text-decoration-none link-underline-opacity-75-hover text-info" href="/detalle_pago_especifico/{{ plazo.id_plazo }}-{{ plazo.cantidad_esperada }}-{{ plazo.restante }}">
																						Ver detalle de pago
																					</a>
																				</td>
																				{% else %}
																				<td class="cell">
																					Acción no disponible
																				</td>
																				{% endif %}
																				{% if plazo.comprobante or plazo.restante != plazo.cantidad_esperada%}
																					<td class="cell">
																						Acción no disponible
																					</td>
																				{% else %}
																				<td class="cell">
																					<button type="button" class="btn btn-link text-decoration-none text-secondary mb-1" data-bs-toggle="modal" data-bs-target="#modalAgregarDetalle" onclick="agregar_nuevo_detalle('{{ plazo.id_plazo }}', '{{ precio_total }}', '{{ plazo.restante }}')">
																						Añadir detalle pago
																					</button>
																				</td>
																				{% endif %}
																				<td class="cell">
																					{% if plazo.comprobante %}
																						Pago completo
																					{% else %}
																						Pago no terminado
																					{% endif %}
																				</td>
																			</tr>
																			{% endfor %}
																		</tbody>
																	</table>
																</div><!--//table-responsive-->
															</div><!--//app-card-body-->
														</div><!--//app-card-->
													</div><!--//col-->
											</div>

											<nav class="app-pagination my-3">
												<ul class="pagination justify-content-center">
													{% if pagina > 1 %}
														<li class="page-item">
															<a class="page-link" href="{{ url_for('clientes.resumen_compra', pagina=pagina-1, tamano_pagina=tamano_pagina, id_compra=id_compra) }}">Anterior</a>
														</li>
													{% else %}
														<li class="page-item disabled">
															<a class="page-link" href="#" tabindex="-1" aria-disabled="true">Anterior</a>
														</li>
													{% endif %}
													{% for p in range(1, (total + tamano_pagina - 1) // tamano_pagina + 1) %}
														<li class="page-item {% if p == pagina %}active{% endif %}">
															<a class="page-link" href="{{ url_for('clientes.resumen_compra', pagina=p, tamano_pagina=tamano_pagina, id_compra=id_compra) }}">{{ p }}</a>
														</li>
													{% endfor %}
													{% if pagina < (total + tamano_pagina - 1) // tamano_pagina  %}
														<li class="page-item">
															<a class="page-link" href="{{ url_for('clientes.resumen_compra', pagina=pagina+1, tamano_pagina=tamano_pagina, id_compra=id_compra) }}">Siguiente</a>
														</li>
													{% else %}
														<li class="page-item disabled">
															<span class="page-link">Siguiente</span>
														</li>
													{%endif %}
												</ul>
											</nav><!--//app-pagination-->
										</div>
										{% endif %}

									</div>
								</div>
							</div>
							<div class="app-card-footer p-4 mt-auto col-mb-2">
								{% for dato in compra %}
									{% if dato.estado_compra == 'Cancelado' %}
										<button type="button" class="btn app-btn-primary" onclick="cambiar_estado_compra('{{ dato.id_compra }}', 'Proceso')">Reactivar compra</button>
									{% elif  dato.estado_compra == 'Proceso' %}
										<button type="button" class="btn app-btn-primary" onclick="cambiar_estado_compra('{{ dato.id_compra }}', 'Finalizado')">Finalizar compra</button>
										<button type="button" class="btn btn-danger" onclick="cambiar_estado_compra('{{ dato.id_compra }}', 'Cancelado')">Cancelar compra</button>
										<button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#formModal">
											Añadir nuevo plazo
										</button>
									{% endif %}
								{% endfor %}
								<a type="button" class="btn app-btn-light" href="/ver_clientes">Cerrar</a>
							</div><!--//app-card-footer-->
                        </div>
                    </div>
                </div>
            </div><!--//container-fluid-->
        </div><!--//app-content-->
        <datalist id="opciones">
            <option value="Estados"></option>
			<option value="Agregar estado de la república"></option>
            <option value="Vendedores"></option>
            <option value="Agregar nuevo vendedor"></option>
            <option value="Vendedores con más ventas"></option>
            <option value="Vendedores con menos ventas"></option>
            <option value="Vendedores activos"></option>
            <option value="Vendedores inactivos"></option>
            <option value="Compras"></option>
            <option value="Compras terminadas"></option>
            <option value="Compras en proceso"></option>
            <option value="Compras canceladas"></option>
            <option value="Agregar nuevo cliente"></option>
            <option value="Notificaciones"></option>
            <option value="Notificaciones no leídas"></option>
            <option value="Notificaciones leídas"></option>
            <option value="Notificaciones más antigüas"></option>
            <option value="Notificaciones más recientes"></option>
            <option value="Recuperar contraseña"></option>
            <option value="Configuración"></option>
        </datalist>
		<footer class="app-footer">
		</footer><!--//app-footer-->
		<div class="modal fade" id="formModal" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="formModalLabel">Ingresa los datos del plazo</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<!-- Formulario -->
						<form id="multiScreenForm" action="/enviar_nuevo_plazo" method="POST">
							<!-- Pantalla 1 -->
							<div id="screen1" class="screen">
								<div class="mb-3">
									<label for="input1" class="form-label">Número de plazo</label>
									<input type="number" class="form-control" id="numero_plazo" name="numero_plazo" placeholder="Ingrese el número de plazo" required>
									<input type="hidden" class="form-control" id="id_compra" name="id_compra" value="{{ id_compra }}" required>
								</div>
								<div class="mb-3">
									<label for="input1" class="form-label">Cantidad de dinero esperada</label>
									<input type="number" class="form-control" id="cantidad_esperada" name="cantidad_esperada" placeholder="Cantidad a recibir el día acordado" step="0.01" required>
								</div>
								<div class="mb-3">
									<label for="input1" class="form-label">Fecha de pago esperada</label>
									<input type="date" class="form-control" id="fecha_esperada" name="fecha_esperada" placeholder="Fecha programada para realizar el pago" required>
								</div>
							</div>
							<button type="submit" class="btn btn-success">Enviar</button>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
					</div>
				</div>
			</div>
		</div>

	<div class="modal fade" id="modalActualizar" tabindex="-1" aria-labelledby="modalActualizarLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="modalActualizarLabel">Ingresa los datos del plazo</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- Formulario -->
					<form id="modalActualizarForm" action="{{ url_for('pagos.enviar_plazo_actualizado') }}" method="POST">
						<!-- Pantalla 1 -->
						<div id="screen1" class="screen">
							<div class="mb-3">
								<label for="numeroPlazo" class="form-label">Número de plazo</label>
								<input type="number" class="form-control" id="numero_plazo" name="numero_plazo" placeholder="Ingrese el número de plazo" required>
								<input type="hidden" class="form-control" id="id_plazo" name="id_plazo" required>
								<input type="hidden" class="form-control" id="id_compra" name="id_compra" value="{{id_compra}}" required>
							</div>
							<div class="mb-3">
								<label for="input1" class="form-label">Cantidad de dinero esperada</label>
								<input type="number" class="form-control" id="cantidad_esperada" name="cantidad_esperada" placeholder="Cantidad a recibir el día acordado" step="0.01" required>
							</div>
							<div class="mb-3">
								<label for="input1" class="form-label">Fecha de pago esperada</label>
								<input type="date" class="form-control" id="fecha_esperada" name="fecha_esperada" placeholder="Fecha programada para realizar el pago" required>
							</div>
						</div>
						<button type="submit" class="btn btn-success">Enviar</button>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalAgregarDetalle" tabindex="-1" aria-labelledby="modalAgregarDetalleLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="modalAgregarDetalleLabel">Ingresa del detalle de plazo</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- Formulario -->
					<form id="modalAgregarDetalleForm" action="{{ url_for('pagos.enviar_nuevo_detalle') }} " method="POST">
						<!-- Pantalla 1 -->
						<div id="screen1" class="screen">
							<div class="mb-3">
								<label for="numeroPlazo" class="form-label">Cantidad total a dar (referencia)</label>
								<input type="number" class="form-control" name="total_plazo" id="total_plazo" placeholder="Cantidad total a dar del plazo" step="0.01" required readonly>
								<input type="hidden" class="form-control" name="total_compra" id="total_compra" placeholder="Cantidad total de la compra" step="0.01" required readonly>
								<input type="hidden" class="form-control" id="id_plazo" name="id_plazo" required readonly>
								<input type="hidden" class="form-control" id="id_compra" name="id_compra" value="{{id_compra}}" required>

							</div>
							<div class="mb-3">
								<label for="input1" class="form-label">Cantidad dada</label>
								<input type="number" class="form-control" id="cantidad_dada" name="cantidad_dada" placeholder="Cantidad recibida el día del pago" step="0.01" required>
							</div>
							<div class="mb-3" id="inputRestante" style="display: none;">
								<label for="restante" class="form-label">Restante</label>
								<div class="input-group">
									<input type="text" class="form-control" id="restante" name="restante" readonly>
									<span class="input-group-text" id="copiarIcono">
										<i class="fas fa-copy"></i>
									</span>
								</div>
							</div>
							<div class="mb-3">
								<label for="input1" class="form-label">Fecha de entrega</label>
								<input type="date" class="form-control" id="fecha_entrega" name="fecha_entrega" placeholder="Fecha que se entrego el pago" required>
							</div>
						</div>
						<button type="submit" class="btn btn-success">Enviar</button>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-bs-dismiss="modal" x-detalle="detalle">Cancelar</button>
				</div>
			</div>
		</div>
	</div>

    </div><!--//app-wrapper-->

   <!-- Javascript -->
   <script src="{{ url_for('static', filename='plugins/popper.min.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/bootstrap/js/bootstrap.min.js') }}"></script>

   <!-- Page Specific JS -->
   <script src="{{ url_for('static', filename='js/app.js') }}"></script>
   <script type="module">
	   // Importar función correspondiente
	   import { cerrar_sesion } from "{{ url_for('static', filename='js/sesion/administrar_sesion.js') }}"
	   import { validarFormulario } from "{{ url_for('static', filename='js/utilidades.js')}}"
	   import { eliminar_plazo, cambiar_estado_compra } from "{{ url_for('static',filename='js/pagos/administrar_pagos.js')}}"

	   // Hacemos accesible a la función
	   window.cerrar_sesion = cerrar_sesion;
	   window.eliminar_plazo = eliminar_plazo;
	   window.agregar_valores = agregar_valores;
	   window.agregar_nuevo_detalle = agregar_nuevo_detalle;
	   window.cambiar_estado_compra = cambiar_estado_compra;


		// Evitar envío del formulario para validar
		document.getElementById("multiScreenForm").addEventListener('submit', function(evento){
                evento.preventDefault();

			// Obtener los posibles errores de la validación
			const errores = validarFormulario('multiScreenForm');

			const modal = bootstrap.Modal.getInstance(document.getElementById('formModal'));
			modal.hide();

			// Verificar
			if (Object.keys(errores).length > 0) {
				alert(Object.values(errores));
			} else {
				alert('Enviando formulario.');
				document.getElementById('multiScreenForm').submit();
			}
        });

		document.getElementById('cantidad_dada').addEventListener('blur', function() {
            const valorUno = parseFloat(document.getElementById('total_plazo').value);
            const valorDos = parseFloat(document.getElementById('cantidad_dada').value);
            const restante = valorUno - valorDos;

            if (restante < 0 || valorDos > valorUno) {
                document.getElementById('restante').value = Math.abs(restante).toFixed(1);
                document.getElementById('inputRestante').style.display = 'block';
            } else {
                document.getElementById('inputRestante').style.display = 'none';
            }
        });

		document.getElementById('copiarIcono').addEventListener('click', function() {
            const restanteInput = document.getElementById('restante');
            restanteInput.select();
            restanteInput.setSelectionRange(0, 99999); // Para dispositivos móviles
            navigator.clipboard.writeText(restanteInput.value).then(() => {
                alert('Valor copiado: ' + restanteInput.value);
            });
        });

		function agregar_nuevo_detalle(id_plazo, cantidad_compra, total_plazo) {

			// Asignar a los valores extraídos a los campos del formulario
			const modal = document.getElementById('modalAgregarDetalle');
			modal.querySelector('#id_plazo').value = id_plazo;
			modal.querySelector('#total_compra').value = cantidad_compra;
			modal.querySelector('#total_plazo').value = total_plazo;
		}

		// Función para agregar valores al modal con id "formModal"
		function agregar_valores(id_plazo) {

			// Buscar la fila correspondiente al id_plazo
			const fila = document.querySelector(`tr[data-id-plazo="${id_plazo}"]`);
			// Extraer los valores de las celdas de la fila
			const numero_plazo = fila.querySelector('.numero_plazo').textContent.trim().replace('Mes', '');
			const cantidad_esperada = fila.querySelector('.cantidad_esperada').textContent.trim().replace('$', '').replace(' MXN', '');
			const fecha_esperada = fila.querySelector('.fecha_esperada').textContent.trim();

			// Asignar los valores extraídos a los campos del formulario en el modal con id "formModal"
			const modal = document.getElementById('modalActualizarForm');
			modal.querySelector('#numero_plazo').value = parseInt(numero_plazo);
			modal.querySelector('#id_plazo').value = id_plazo;
			modal.querySelector('#cantidad_esperada').value = cantidad_esperada;
			modal.querySelector('#fecha_esperada').value = fecha_esperada;

		}

		// Función para limpiar los valores al cancelar, solo en el modal con id "formModal"
		function limpiarValoresModal() {
			const modal = document.getElementById('modalActualizarForm');
			modal.querySelector('#numero_plazo').value = '';
			modal.querySelector('#id_plazo').value = '';
			modal.querySelector('#cantidad_esperada').value = '';
			modal.querySelector('#fecha_esperada').value = '';
		}

		function limpiarValoresDetalle() {
			const modal = document.getElementById('modalAgregarDetalle');
			modal.querySelector('#cantidad_dada').value = '';
			modal.querySelector('#total_compra').value = '';
			modal.querySelector('#id_plazo').value = '';
			modal.querySelector('#fecha_entrega').value = '';
			modal.querySelector('#total_plazo').value = '';
			modal.querySelector('#restante').value = '';
			document.getElementById('inputRestante').style.display = 'none';

		}


		// Asignar la función limpiarValoresModal al botón de cancelar en el modal con id "formModal"
		document.querySelector('.btn-danger[data-bs-dismiss="modal"]').addEventListener('click', limpiarValoresModal);
		document.querySelector('.btn-danger[x-detalle="detalle"]').addEventListener('click', limpiarValoresDetalle);

		// Evitar envío del formulario para validar
		document.getElementById("modalActualizarForm").addEventListener('submit', function(evento){
		evento.preventDefault();

			// Obtener los posibles errores de la validación
			const errores = validarFormulario('modalActualizarForm');

			const modal = bootstrap.Modal.getInstance(document.getElementById('modalActualizar'));
			modal.hide();

			// Verificar
			if (Object.keys(errores).length > 0) {
				alert(Object.values(errores));
			} else {
				alert('Enviando formulario.');
				document.getElementById('modalActualizarForm').submit();
			}
        });

		document.getElementById("modalAgregarDetalleForm").addEventListener('submit', function(evento){
		evento.preventDefault();

			// Obtener los posibles errores de la validación
			const errores = validarFormulario('modalAgregarDetalleForm');

			const modal = bootstrap.Modal.getInstance(document.getElementById('modalAgregarDetalle'));
			modal.hide();

			// Verificar
			if (Object.keys(errores).length > 0) {
				alert(Object.values(errores));
			} else {
				alert('Enviando formulario.');
				document.getElementById('modalAgregarDetalleForm').submit();
			}
        });
   </script>
</body>
</html>

